import numpy as np
import pandas as pd
import tensorflow as tf
from preprocessing import getMulliganWinRates
from itertools import combinations

def enterExample():
    hand = [float(input("Number of cards")), float(input("On play? 1 for yes, 0 for no."))]
    count = int(input("Number of cards to enter"))
    for i in range(count):
        hand.append(input("Enter card name"))
    return hand

#configured for neural network
#example is a list, list[0] is number of cards as a float, list[1] is play/draw as 1.0 or 0.0, list [2:] are the names of cards in hand as formattedon front of card
def predictExample(example, model, keys):
    if(len(example)==example[0]+2):
        features = {name: np.array([0.0]) for name in keys}
        features["cards"][0]=example[0]/7
        features["on_play"][0]=example[1]
        for card in example[2:]:
            features["opening_hand_"+card.replace(" ", "_").replace(",", "").replace("'", "")][0]+=1/7
        preds = model.predict(x=features, verbose=0)
        return ("Probability of winning: "+str(preds[0]))
    
    elif(len(example)>example[0]+2):#this could also do what the above does, but it's a little slower
        possibleHands = list(combinations(range(2, len(example)), int(example[0])))
        features = {name: np.full(shape=len(possibleHands), fill_value=0.0, dtype=np.float) for name in keys}
        for i in range(len(possibleHands)):
            features["cards"][i]=example[0]/7
            features["on_play"][i]=example[1]
            indexes=list(possibleHands[i])
            for index in indexes:
                card=example[index]
                features["opening_hand_"+card.replace(" ", "_").replace(",", "").replace("'", "")][i]+=1/7
        preds = model.predict(x=features, verbose=0)
        #for i in range(len(possibleHands)):#remove this for loop to only show the best hand
        #    handIndices = list(possibleHands[i])
        #    hand = []
        #    for index in handIndices:
        #        hand.append(example[index])
        #    print("This hand: "+str(hand)+" has this probability of winning: "+str(preds[i]))
        bestIndex = np.argmax(preds)
        bestHandIndices = list(possibleHands[bestIndex])
        bestHand = []
        for index in bestHandIndices:
            bestHand.append(example[index])
        return ("Keep the following cards: "+str(bestHand)+"\nProbability of winning: "+str(preds[bestIndex]))
    
    else:
        print("Something went seriously wrong here, the hand is missing some cards")

def setup():
    model = tf.keras.models.load_model('model_30_sep_2021_2')
    keys=['on_play', 'opening_hand_Abundant_Harvest', 'opening_hand_Academic_Dispute', 'opening_hand_Academic_Probation', 'opening_hand_Access_Tunnel', 'opening_hand_Accomplished_Alchemist', 'opening_hand_Adventurous_Impulse', 'opening_hand_Aether_Helix', 'opening_hand_Ageless_Guardian', 'opening_hand_Agonizing_Remorse', 'opening_hand_Approach_of_the_Second_Sun', 'opening_hand_Arcane_Subtraction', 'opening_hand_Archmage_Emeritus', 'opening_hand_Archway_Commons', 'opening_hand_Ardent_Dustspeaker', 'opening_hand_Arrogant_Poet', 'opening_hand_Augmenter_Pugilist', 'opening_hand_Baleful_Mastery', 'opening_hand_Basic_Conjuration', 'opening_hand_Bayou_Groff', 'opening_hand_Beaming_Defiance', 'opening_hand_Beledros_Witherbloom', 'opening_hand_Biblioplex_Assistant', 'opening_hand_Big_Play', 'opening_hand_Biomathematician', 'opening_hand_Blade_Historian', 'opening_hand_Blex_Vexing_Pest', 'opening_hand_Blood_Age_General', 'opening_hand_Blood_Researcher', 'opening_hand_Blot_Out_the_Sky', 'opening_hand_Blue_Suns_Zenith', 'opening_hand_Body_of_Research', 'opening_hand_Bookwurm', 'opening_hand_Brackish_Trudge', 'opening_hand_Brainstorm', 'opening_hand_Burrog_Befuddler', 'opening_hand_Bury_in_Books', 'opening_hand_Callous_Bloodmage', 'opening_hand_Campus_Guide', 'opening_hand_Channel', 'opening_hand_Chaos_Warp', 'opening_hand_Charge_Through', 'opening_hand_Claim_the_Firstborn', 'opening_hand_Clever_Lumimancer', 'opening_hand_Closing_Statement', 'opening_hand_Codie_Vociferous_Codex', 'opening_hand_Cogwork_Archivist', 'opening_hand_Combat_Professor', 'opening_hand_Compulsive_Research', 'opening_hand_Confront_the_Past', 'opening_hand_Conspiracy_Theorist', 'opening_hand_Containment_Breach', 'opening_hand_Counterspell', 'opening_hand_Crackle_with_Power', 'opening_hand_Cram_Session', 'opening_hand_Creative_Outburst', 'opening_hand_Crushing_Disappointment', 'opening_hand_Crux_of_Fate', 'opening_hand_Culling_Ritual', 'opening_hand_Culmination_of_Studies', 'opening_hand_Cultivate', 'opening_hand_Curate', 'opening_hand_Daemogoth_Titan', 'opening_hand_Daemogoth_Woe-Eater', 'opening_hand_Dark_Ritual', 'opening_hand_Day_of_Judgment', 'opening_hand_Deadly_Brew', 'opening_hand_Decisive_Denial', 'opening_hand_Defend_the_Campus', 'opening_hand_Defiant_Strike', 'opening_hand_Demonic_Tutor', 'opening_hand_Despark', 'opening_hand_Detention_Vortex', 'opening_hand_Devastating_Mastery', 'opening_hand_Devouring_Tendrils', 'opening_hand_Dina_Soul_Steeper', 'opening_hand_Divide_by_Zero', 'opening_hand_Divine_Gambit', 'opening_hand_Doom_Blade', 'opening_hand_Double_Major', 'opening_hand_Draconic_Intervention', 'opening_hand_Dragons_Approach', 'opening_hand_Dragonsguard_Elite', 'opening_hand_Dramatic_Finale', 'opening_hand_Dream_Strix', 'opening_hand_Dueling_Coach', 'opening_hand_Duress', 'opening_hand_Eager_First-Year', 'opening_hand_Ecological_Appreciation', 'opening_hand_Efreet_Flamepainter', 'opening_hand_Electrolyze', 'opening_hand_Elemental_Expressionist', 'opening_hand_Elemental_Masterpiece', 'opening_hand_Elemental_Summoning', 'opening_hand_Eliminate', 'opening_hand_Elite_Spellbinder', 'opening_hand_Emergent_Sequence', 'opening_hand_Enthusiastic_Study', 'opening_hand_Environmental_Sciences', 'opening_hand_Ephemerate', 'opening_hand_Essence_Infusion', 'opening_hand_Eureka_Moment', 'opening_hand_Excavated_Wall', 'opening_hand_Exhilarating_Elocution', 'opening_hand_Expanded_Anatomy', 'opening_hand_Expel', 'opening_hand_Explosive_Welcome', 'opening_hand_Exponential_Growth', 'opening_hand_Expressive_Iteration', 'opening_hand_Extus_Oriq_Overlord', 'opening_hand_Eyetwitch', 'opening_hand_Faithless_Looting', 'opening_hand_Fervent_Mastery', 'opening_hand_Field_Trip', 'opening_hand_First_Day_of_Class', 'opening_hand_Flamescroll_Celebrant', 'opening_hand_Flunk', 'opening_hand_Forest', 'opening_hand_Fortifying_Draught', 'opening_hand_Fractal_Summoning', 'opening_hand_Fracture', 'opening_hand_Frost_Trickster', 'opening_hand_Frostboil_Snarl', 'opening_hand_Fuming_Effigy', 'opening_hand_Furycalm_Snarl', 'opening_hand_Galazeth_Prismari', 'opening_hand_Gift_of_Estates', 'opening_hand_Gnarled_Professor', 'opening_hand_Go_Blank', 'opening_hand_Gods_Willing', 'opening_hand_Golden_Ratio', 'opening_hand_Grapeshot', 'opening_hand_Grinning_Ignus', 'opening_hand_Growth_Spiral', 'opening_hand_Guiding_Voice', 'opening_hand_Hall_Monitor', 'opening_hand_Hall_of_Oracles', 'opening_hand_Harmonize', 'opening_hand_Harness_Infinity', 'opening_hand_Heated_Debate', 'opening_hand_Hofri_Ghostforge', 'opening_hand_Honor_Troll', 'opening_hand_Humiliate', 'opening_hand_Hunt_for_Specimens', 'opening_hand_Igneous_Inspiration', 'opening_hand_Illuminate_History', 'opening_hand_Illustrious_Historian', 'opening_hand_Increasing_Vengeance', 'opening_hand_Infuriate', 'opening_hand_Infuse_with_Vitality', 'opening_hand_Ingenious_Mastery', 'opening_hand_Inkling_Summoning', 'opening_hand_Inquisition_of_Kozilek', 'opening_hand_Introduction_to_Annihilation', 'opening_hand_Introduction_to_Prophecy', 'opening_hand_Island', 'opening_hand_Jadzi_Oracle_of_Arcavios', 'opening_hand_Karok_Wrangler', 'opening_hand_Kasmina_Enigma_Sage', 'opening_hand_Kelpie_Guide', 'opening_hand_Kianne_Dean_of_Substance', 'opening_hand_Killian_Ink_Duelist', 'opening_hand_Krosan_Grip', 'opening_hand_Lash_of_Malice', 'opening_hand_Leech_Fanatic', 'opening_hand_Leonin_Lightscribe', 'opening_hand_Letter_of_Acceptance', 'opening_hand_Leyline_Invocation', 'opening_hand_Lightning_Bolt', 'opening_hand_Lightning_Helix', 'opening_hand_Lorehold_Apprentice', 'opening_hand_Lorehold_Campus', 'opening_hand_Lorehold_Command', 'opening_hand_Lorehold_Excavation', 'opening_hand_Lorehold_Pledgemage', 'opening_hand_Maelstrom_Muse', 'opening_hand_Mage_Duel', 'opening_hand_Mage_Hunter', 'opening_hand_Mage_Hunters_Onslaught', 'opening_hand_Magma_Opus', 'opening_hand_Make_Your_Mark', 'opening_hand_Mana_Tithe', 'opening_hand_Manifestation_Sage', 'opening_hand_Mascot_Exhibition', 'opening_hand_Mascot_Interception', 'opening_hand_Master_Symmetrist', 'opening_hand_Mavinda_Students_Advocate', 'opening_hand_Memory_Lapse', 'opening_hand_Mentors_Guidance', 'opening_hand_Mercurial_Transformation', 'opening_hand_Mila_Crafty_Companion', 'opening_hand_Minds_Desire', 'opening_hand_Mizzixs_Mastery', 'opening_hand_Moldering_Karok', 'opening_hand_Mortality_Spear', 'opening_hand_Mountain', 'opening_hand_Multiple_Choice', 'opening_hand_Natural_Order', 'opening_hand_Necroblossom_Snarl', 'opening_hand_Necrotic_Fumes', 'opening_hand_Needlethorn_Drake', 'opening_hand_Negate', 'opening_hand_Novice_Dissector', 'opening_hand_Oggyar_Battle-Seer', 'opening_hand_Opt', 'opening_hand_Oriq_Loremage', 'opening_hand_Overgrown_Arch', 'opening_hand_Owlin_Shieldmage', 'opening_hand_Pest_Summoning', 'opening_hand_Pestilent_Cauldron', 'opening_hand_Pigment_Storm', 'opening_hand_Pilgrim_of_the_Ages', 'opening_hand_Pillardrop_Rescuer', 'opening_hand_Pillardrop_Warden', 'opening_hand_Plains', 'opening_hand_Plargg_Dean_of_Chaos', 'opening_hand_Plumb_the_Forbidden', 'opening_hand_Poets_Quill', 'opening_hand_Pop_Quiz', 'opening_hand_Practical_Research', 'opening_hand_Primal_Command', 'opening_hand_Prismari_Apprentice', 'opening_hand_Prismari_Campus', 'opening_hand_Prismari_Command', 'opening_hand_Prismari_Pledgemage', 'opening_hand_Professor_Onyx', 'opening_hand_Professor_of_Symbology', 'opening_hand_Professor_of_Zoomancy', 'opening_hand_Professors_Warning', 'opening_hand_Promising_Duskmage', 'opening_hand_Putrefy', 'opening_hand_Quandrix_Apprentice', 'opening_hand_Quandrix_Campus', 'opening_hand_Quandrix_Command', 'opening_hand_Quandrix_Cultivator', 'opening_hand_Quandrix_Pledgemage', 'opening_hand_Quintorius_Field_Historian', 'opening_hand_Radiant_Scrollwielder', 'opening_hand_Reckless_Amplimancer', 'opening_hand_Reconstruct_History', 'opening_hand_Reduce_to_Memory', 'opening_hand_Reflective_Golem', 'opening_hand_Regrowth', 'opening_hand_Reject', 'opening_hand_Relic_Sloth', 'opening_hand_Resculpt', 'opening_hand_Retriever_Phoenix', 'opening_hand_Returned_Pastcaller', 'opening_hand_Revitalize', 'opening_hand_Rip_Apart', 'opening_hand_Rise_of_Extus', 'opening_hand_Rootha_Mercurial_Artist', 'opening_hand_Rowan_Scholar_of_Sparks', 'opening_hand_Rushed_Rebirth', 'opening_hand_Scurrid_Colony', 'opening_hand_Secret_Rendezvous', 'opening_hand_Sedgemoor_Witch', 'opening_hand_Selfless_Glyphweaver', 'opening_hand_Semesters_End', 'opening_hand_Serpentine_Curve', 'opening_hand_Shadewing_Laureate', 'opening_hand_Shadrix_Silverquill', 'opening_hand_Shaile_Dean_of_Radiance', 'opening_hand_Shineshadow_Snarl', 'opening_hand_Shock', 'opening_hand_Show_of_Confidence', 'opening_hand_Sign_in_Blood', 'opening_hand_Silverquill_Apprentice', 'opening_hand_Silverquill_Campus', 'opening_hand_Silverquill_Command', 'opening_hand_Silverquill_Pledgemage', 'opening_hand_Silverquill_Silencer', 'opening_hand_Snakeskin_Veil', 'opening_hand_Snow_Day', 'opening_hand_Solve_the_Equation', 'opening_hand_Soothsayer_Adept', 'opening_hand_Sparring_Regimen', 'opening_hand_Spectacle_Mage', 'opening_hand_Specter_of_the_Fens', 'opening_hand_Spell_Satchel', 'opening_hand_Spined_Karok', 'opening_hand_Spirit_Summoning', 'opening_hand_Spiteful_Squad', 'opening_hand_Springmane_Cervin', 'opening_hand_Square_Up', 'opening_hand_Star_Pupil', 'opening_hand_Start_from_Scratch', 'opening_hand_Stone_Rain', 'opening_hand_Stonebinders_Familiar', 'opening_hand_Stonebound_Mentor', 'opening_hand_Stonerise_Spirit', 'opening_hand_Storm-Kiln_Artist', 'opening_hand_Strategic_Planning', 'opening_hand_Strict_Proctor', 'opening_hand_Strixhaven_Stadium', 'opening_hand_Study_Break', 'opening_hand_Sudden_Breakthrough', 'opening_hand_Swamp', 'opening_hand_Swords_to_Plowshares', 'opening_hand_Symmetry_Sage', 'opening_hand_Tainted_Pact', 'opening_hand_Tanazir_Quandrix', 'opening_hand_Tangletrap', 'opening_hand_Teach_by_Example', 'opening_hand_Teachings_of_the_Archaics', 'opening_hand_Team_Pennant', 'opening_hand_Teferis_Protection', 'opening_hand_Tempted_by_the_Oriq', 'opening_hand_Tend_the_Pests', 'opening_hand_Tendrils_of_Agony', 'opening_hand_Tenured_Inkcaster', 'opening_hand_Test_of_Talents', 'opening_hand_Tezzerets_Gambit', 'opening_hand_The_Biblioplex', 'opening_hand_Thrill_of_Possibility', 'opening_hand_Thrilling_Discovery', 'opening_hand_Thunderous_Orator', 'opening_hand_Time_Warp', 'opening_hand_Tome_Shredder', 'opening_hand_Torrent_Sculptor', 'opening_hand_Twinscroll_Shaman', 'opening_hand_Umbral_Juke', 'opening_hand_Unwilling_Ingredient', 'opening_hand_Urzas_Rage', 'opening_hand_Uvilda_Dean_of_Perfection', 'opening_hand_Valentin_Dean_of_the_Vein', 'opening_hand_Vanishing_Verse', 'opening_hand_Velomachus_Lorehold', 'opening_hand_Venerable_Warsinger', 'opening_hand_Verdant_Mastery', 'opening_hand_Village_Rites', 'opening_hand_Vineglimmer_Snarl', 'opening_hand_Vortex_Runner', 'opening_hand_Wandering_Archaic', 'opening_hand_Waterfall_Aerialist', 'opening_hand_Weather_the_Storm', 'opening_hand_Whirlwind_Denial', 'opening_hand_Witherbloom_Apprentice', 'opening_hand_Witherbloom_Campus', 'opening_hand_Witherbloom_Command', 'opening_hand_Witherbloom_Pledgemage', 'opening_hand_Wormhole_Serpent', 'opening_hand_Zephyr_Boots', 'opening_hand_Zimone_Quandrix_Prodigy', 'cards']
    return model, keys