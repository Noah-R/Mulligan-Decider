from flask import Flask, render_template, request
from prediction import setup, predictExample
from markupsafe import escape

cardnames=["Adeline, Resplendent Cathar", "Ambitious Farmhand", "Beloved Beggar", "Bereaved Survivor", "Blessed Defiance", "Borrowed Time", "Brutal Cathar", "Candlegrove Witch", "Candletrap", "Cathar Commando", "Cathar's Call", "Celestus Sanctifier", "Chaplain of Alms", "Clarion Cathars", "Curse of Silence", "Duelcraft Trainer", "Enduring Angel", "Fateful Absence", "Flare of Faith", "Gavony Dawnguard", "Gavony Silversmith", "Gavony Trapper", "Hedgewitch's Mask", "Homestead Courage", "Intrepid Adversary", "Loyal Gryff", "Lunarch Veteran", "Mourning Patrol", "Odric's Outrider", "Ritual Guardian", "Ritual of Hope", "Search Party Captain", "Sigarda's Splendor", "Sigardian Savior", "Soul-Guide Gryff", "Sungold Barrage", "Sungold Sentinel", "Sunset Revelry", "Thraben Exorcism", "Unruly Mob", "Vanquish the Horde", "Baithook Angler", "Component Collector", "Consider", "Covetous Castaway", "Curse of Surveillance", "Delver of Secrets", "Devious Cover-Up", "Dissipate", "Drownyard Amalgam", "Fading Hope", "Falcon Abomination", "Firmament Sage", "Flip the Switch", "Galedrifter", "Geistwave", "Grafted Identity", "Larder Zombie", "Lier, Disciple of the Drowned", "Locked in the Cemetery", "Malevolent Hermit", "Memory Deluge", "Mysterious Tome", "Nebelgast Intruder", "Ominous Roost", "Organ Hoarder", "Otherworldly Gaze", "Overwhelmed Archivist", "Patrician Geist", "Phantom Carriage", "Poppet Stitcher", "Revenge of the Drowned", "Secrets of the Key", "Shipwreck Sifters", "Skaab Wrangler", "Sludge Monster", "Spectral Adversary", "Startle", "Stormrider Spirit", "Suspicious Stowaway", "Triskaidekaphile", "Unblinking Observer", "Vivisection", "Arrogant Outlaw", "Baneblade Scoundrel", "Bat Whisperer", "Bladebrand", "Blood Pact", "Bloodline Culling", "Bloodtithe Collector", "Champion of the Perished", "Covert Cutpurse", "Crawl from the Cellar", "Curse of Leeches", "Defenestrate", "Diregraf Horde", "Dreadhound", "Duress", "Eaten Alive", "Ecstatic Awakener", "Foul Play", "Ghoulish Procession", "Gisa, Glorious Resurrector", "Graveyard Trespasser", "Heirloom Mirror", "Hobbling Zombie", "Infernal Grasp", "Jadar, Ghoulcaller of Nephalia", "Jerren, Corrupted Bishop", "Lord of the Forsaken", "Mask of Griselbrand", "The Meathook Massacre", "Morbid Opportunist", "Morkrut Behemoth", "Necrosynthesis", "No Way Out", "Novice Occultist", "Olivia's Midnight Ambush", "Rotten Reunion", "Shady Traveler", "Siege Zombie", "Slaughter Specialist", "Stromkirk Bloodthief", "Tainted Adversary", "Vampire Interloper", "Vengeful Strangler", "Abandon the Post", "Ardent Elementalist", "Bloodthirsty Adversary", "Brimstone Vandal", "Burn Down the House", "Burn the Accursed", "Cathartic Pyre", "Curse of Shaken Faith", "Electric Revelation", "Falkenrath Perforator", "Falkenrath Pit Fighter", "Famished Foragers", "Fangblade Brigand", "Festival Crasher", "Flame Channeler", "Geistflame Reservoir", "Harvesttide Infiltrator", "Immolation", "Lambholt Harrier", "Light Up the Night", "Lunar Frenzy", "Moonrager's Slash", "Moonveil Regent", "Mounted Dreadknight", "Neonate's Rush", "Obsessive Astronomer", "Pack's Betrayal", "Play with Fire", "Purifying Dragon", "Raze the Effigy", "Reckless Stormseeker", "Seize the Storm", "Smoldering Egg", "Spellrune Painter", "Stolen Vitality", "Sunstreak Phoenix", "Tavern Ruffian", "Thermo-Alchemist", "Village Watch", "Voldaren Ambusher", "Voldaren Stinger", "Augur of Autumn", "Bird Admirer", "Bounding Wolf", "Bramble Armor", "Briarbridge Tracker", "Brood Weaver", "Burly Breaker", "Clear Shot", "Consuming Blob", "Contortionist Troupe", "Dawnhart Mentor", "Dawnhart Rejuvenator", "Deathbonnet Sprout", "Defend the Celestus", "Dryad's Revival", "Duel for Dominance", "Eccentric Farmer", "Harvesttide Sentry", "Hound Tamer", "Howl of the Hunt", "Might of the Old Ways", "Outland Liberator", "Path to the Festival", "Pestilent Wolf", "Plummet", "Primal Adversary", "Return to Nature", "Rise of the Ants", "Saryth, the Viper's Fang", "Shadowbeast Sighting", "Snarling Wolf", "Storm the Festival", "Tapping at the Window", "Timberland Guide", "Tireless Hauler", "Tovolar's Huntmaster", "Turn the Earth", "Unnatural Growth", "Willow Geist", "Wrenn and Seven", "Angelfire Ignition", "Arcane Infusion", "Arlinn, the Pack's Hope", "Bladestitched Skaab", "Can't Stay Away", "Corpse Cobble", "Croaking Counterpart", "Dawnhart Wardens", "Dennick, Pious Apprentice", "Devoted Grafkeeper", "Dire-Strain Rampage", "Diregraf Rebirth", "Faithful Mending", "Fleshtaker", "Florian, Voldaren Scion", "Galvanic Iteration", "Ghoulcaller's Harvest", "Grizzly Ghoul", "Hallowed Respite", "Hungry for More", "Join the Dance", "Katilda, Dawnhart Prime", "Kessig Naturalist", "Liesa, Forgotten Archangel", "Ludevic, Necrogenius", "Old Stickfingers", "Rem Karolus, Stalwart Slayer", "Rite of Harmony", "Rite of Oblivion", "Rootcoil Creeper", "Sacred Fire", "Sigarda, Champion of Light", "Siphon Insight", "Slogurk, the Overslime", "Storm Skreelix", "Sunrise Cavalier", "Teferi, Who Slows the Sunset", "Tovolar, Dire Overlord", "Unnatural Moonrise", "Vadrik, Astral Archmage", "Vampire Socialite", "Wake to Slaughter", "Winterthorn Blessing", "The Celestus", "Crossroads Candleguide", "Jack-o'-Lantern", "Moonsilver Key", "Mystic Skull", "Pithing Needle", "Silver Bolt", "Stuffed Bear", "Deserted Beach", "Evolving Wilds", "Field of Ruin", "Haunted Ridge", "Hostile Hostel", "Overgrown Farmland", "Rockfall Vale", "Shipwreck Marsh", "Plains", "Island", "Swamp", "Mountain", "Forest"]#no-model verson
#model, keys, cardnames, mulliganWinRates = setup("model_10_oct_2021_1", "keys.txt", "cardnames.txt", "mulliganWinRates.txt")
app = Flask(__name__)

@app.route("/", methods=['GET'])
def main_page():
    return render_template('mainpage.html', cardnames=cardnames)

@app.route('/predict', methods=['POST'])
def predict():
    req = request.get_json()
    example = [float(req["cards"]), float(req["onplay"])] + str(req["hand"]).replace(", ", " ").split(",")
    result = predictExample(example, model, keys, mulliganWinRates)
    print(result)
    return escape(result)


@app.route("/about", methods=['GET'])
def about_page():
    return render_template('about.html')